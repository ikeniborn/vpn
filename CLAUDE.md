# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This repository contains a Docker-based V2Ray VPN server implementation using the VLESS protocol. The system consists of:

- `install_vpn.sh` - Server installation and configuration script
- `manage_users.sh` - User management utility

The VPN server runs in a Docker container, making it easy to deploy and manage on any Linux server.

## Commands

### Installation

To install the VPN server:

```bash
sudo ./install_vpn.sh
```

During installation, you'll be prompted to enter:
- Server IP address (defaults to your public IP)
- VPN server port (defaults to 443)
- UUID for the first user (a random UUID is generated by default)
- Name for the first user (defaults to "user1")
- SNI domain (defaults to www.microsoft.com)

### User Management

The management script is automatically installed and can be accessed using:

```bash
sudo v2ray-manage
```

This provides a menu-driven interface for:
1. Listing users
2. Adding users
3. Deleting users
4. Editing users
5. Showing user connection details (with QR codes)
6. Checking server status
7. Restarting the server

### Docker Operations

To manually manage the Docker container:

```bash
# Stop the VPN server
cd /opt/v2ray && docker-compose down

# Start the VPN server
cd /opt/v2ray && docker-compose up -d

# Restart the VPN server
cd /opt/v2ray && docker-compose restart

# View container status
cd /opt/v2ray && docker-compose ps
```

## Server Configuration

The server configuration is stored in the following locations:

- Main working directory: `/opt/v2ray/`
- Server configuration file: `/opt/v2ray/config/config.json`
- Docker Compose configuration: `/opt/v2ray/docker-compose.yml`
- User data and connection information: `/opt/v2ray/users/`

## Architecture

- The VPN server uses the V2Ray VLESS protocol over TCP
- Docker container runs the v2fly/v2fly-core image
- The configuration uses host networking mode for optimal performance
- Each user has a unique UUID for authentication
- Connection details are generated as text file links and QR codes for mobile devices
- UFW firewall is automatically configured to allow only SSH and the VPN port