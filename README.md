# V2Ray VPN Server with Docker

## Overview

This project provides a simple and effective way to set up a V2Ray VPN server using the VLESS protocol with Docker. It consists of two main scripts:

1. `install_vpn.sh` - For server installation and initial configuration
2. `manage_users.sh` - For user management (adding, removing, editing users)

The solution offers a secure VPN service that runs in a Docker container, making it easy to deploy and manage.

## Features

- **Easy Installation**: Automated setup process with minimal user input required
- **Docker-based**: Runs in a containerized environment for better isolation and security
- **VLESS Protocol**: Uses V2Ray's lightweight VLESS protocol over TCP
- **User Management**: Complete toolset for managing VPN users
  - Add new users with unique UUIDs
  - Remove existing users
  - Edit user information
  - View user connection details
  - Generate QR codes for easy mobile device setup
- **Server Monitoring**: Check server status and running services
- **Firewall Configuration**: Automatically configures UFW firewall rules

## Requirements

- Linux server with root access
- Internet connectivity
- Recommended: Fresh Ubuntu 20.04+ or Debian 10+ installation

The installation script will automatically install the following dependencies if they're not already present:
- Docker
- Docker Compose
- UFW (Uncomplicated Firewall)
- uuid
- qrencode
- jq

## Installation

### 1. Download the Installation Script

```bash
wget -O install_vpn.sh https://raw.githubusercontent.com/path/to/install_vpn.sh
chmod +x install_vpn.sh
```

### 2. Run the Installation Script

```bash
sudo ./install_vpn.sh
```

### 3. Follow the Prompts

During installation, you'll be prompted to enter:
- Server IP address (defaults to your public IP)
- VPN server port (defaults to 443)
- UUID for the first user (a random UUID is generated by default)
- Name for the first user (defaults to "user1")

### 4. Installation Complete

After the script completes:
- The VPN server will be running in a Docker container
- The first user will be configured
- Connection details will be displayed and saved to `/opt/v2ray/users/`

## User Management

### Accessing the Management Script

The user management script is automatically installed and can be accessed using:

```bash
sudo v2ray-manage
```

### Available Operations

The management script provides a menu with the following options:

1. **List Users**: View all configured VPN users
2. **Add User**: Create a new VPN user with a unique UUID
3. **Delete User**: Remove an existing VPN user
4. **Edit User**: Modify an existing user's name or UUID
5. **Show User Data**: Display a user's connection details and QR code
6. **Server Status**: Check the VPN server status
7. **Restart Server**: Restart the VPN server after configuration changes

### User Connection Information

For each user, the system generates:
- A text file with connection details (`/opt/v2ray/users/USERNAME.link`)
- A PNG image with a QR code for mobile clients (`/opt/v2ray/users/USERNAME.png`)
- A JSON file with user configuration (`/opt/v2ray/users/USERNAME.json`)

## Client Setup

### Compatible VPN Clients

The VPN server uses the V2Ray VLESS protocol, which is supported by several client applications:

**Windows**
- [v2rayN](https://github.com/2dust/v2rayN)
- [Qv2ray](https://github.com/Qv2ray/Qv2ray)

**macOS**
- [V2RayX](https://github.com/Cenmrev/V2RayX)
- [ClashX](https://github.com/yichengchen/clashX)

**Android**
- [v2rayNG](https://github.com/2dust/v2rayNG)
- [Kitsunebi](https://github.com/eycorsican/kitsunebi-android)

**iOS**
- [Shadowrocket](https://apps.apple.com/us/app/shadowrocket/id932747118)
- [Quantumult X](https://apps.apple.com/us/app/quantumult-x/id1443988620)

**Linux**
- [Qv2ray](https://github.com/Qv2ray/Qv2ray)
- Command line v2ray-core

### Connection Setup

1. **Using QR Code (Mobile Devices)**
   - Open your compatible V2Ray client app
   - Use the QR code scanner function
   - Scan the QR code displayed in terminal or from `/opt/v2ray/users/USERNAME.png`
   - Save and enable the connection

2. **Using Connection Link**
   - Copy the connection link from `/opt/v2ray/users/USERNAME.link`
   - In your V2Ray client, import from clipboard or add a new server
   - Paste the copied link
   - Save and enable the connection

3. **Manual Configuration**
   - Add a new VLESS server in your client
   - Enter the following details:
     - Address: Your server IP
     - Port: Your server port (default 443)
     - UUID: Your user UUID
     - Transport: TCP
     - Encryption: none

### Testing Your Connection

After setting up the client:
1. Connect to the VPN
2. Visit a website like [whatismyip.com](https://whatismyip.com) to verify your IP address has changed
3. If you encounter connection issues, verify that your firewall allows the VPN port

## Technical Details

### Directory Structure

- `/opt/v2ray/` - Main working directory
- `/opt/v2ray/config/` - Server configuration files
- `/opt/v2ray/users/` - User data and connection information

### Configuration Files

- `/opt/v2ray/config/config.json` - V2Ray server configuration
- `/opt/v2ray/docker-compose.yml` - Docker Compose configuration

### Docker Container

The VPN server runs in a Docker container using the official V2Fly/V2Ray image, with host networking mode for optimal performance and simplicity.

### Security Considerations

- The server uses port 443 by default (customizable)
- The UFW firewall is automatically configured to allow only SSH and the VPN port
- Each user has a unique UUID for authentication
- Server logs are configured with minimal verbosity (warning level only)